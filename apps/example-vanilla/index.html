<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Beacon SDK - Vanilla Example</title>
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Beacon SDK Example</h1>
        <div class="connection-status" id="connection-status">
          <span class="status-dot"></span>
          <span class="status-text">Disconnected</span>
        </div>
      </header>

      <!-- How It Works -->
      <details class="how-it-works">
        <summary>How Identity Tracking Works</summary>
        <div class="details-content">
          <p>Beacon uses three IDs to track user activity:</p>
          <dl>
            <dt><code>anon_id</code></dt>
            <dd>Generated on SDK init. Persists until page refresh. All events have this.</dd>

            <dt><code>session_id</code></dt>
            <dd>Generated on init, rotates after 30min inactivity.</dd>

            <dt><code>user_id</code></dt>
            <dd>Set when you call <code>identify()</code>. Links anonymous activity to a known user.</dd>
          </dl>
          <p class="flow-description">
            <strong>Flow:</strong> Anonymous events (user_id=null) → User signs in →
            <code>identify("user@example.com")</code> → Future events include user_id →
            Join on anon_id for retroactive attribution.
          </p>
        </div>
      </details>

      <!-- User State Display -->
      <section class="user-state">
        <div class="user-info" id="user-info">
          <span class="user-label">Tracking as:</span>
          <span class="user-value" id="user-display">Anonymous</span>
        </div>
      </section>

      <!-- Auth Section - changes based on login state -->
      <section class="auth" id="auth-section">
        <h2>Sign In</h2>
        <p class="auth-description">
          Events are tracked anonymously. Sign in to link your activity to your
          account.
        </p>
        <form id="login-form" class="login-form">
          <input
            type="text"
            id="username-input"
            placeholder="Enter username (e.g., john@example.com)"
            required
          />
          <button type="submit">Sign In</button>
        </form>
      </section>

      <!-- Logged-in state (hidden by default) -->
      <section class="auth logged-in" id="logged-in-section" style="display: none">
        <h2>Welcome back!</h2>
        <p class="auth-description">
          You're signed in as <strong id="logged-in-username"></strong>. All
          events are now linked to your account.
        </p>
        <button id="logout-btn" class="secondary">Sign Out</button>
      </section>

      <!-- Actions -->
      <section class="actions">
        <h2>Interact with the App</h2>
        <p class="section-description">
          These buttons simulate real user interactions. Watch the event log to
          see what gets tracked.
        </p>
        <div class="button-group">
          <button id="btn-add-cart">Add to Cart</button>
          <button id="btn-checkout">Start Checkout</button>
          <button id="btn-upgrade">View Pricing</button>
        </div>
      </section>

      <!-- Feature Flags -->
      <section class="flags">
        <h2>Feature Flags</h2>
        <div id="flags-container">
          <p class="placeholder">No flags received yet</p>
        </div>
      </section>

      <!-- Event Log -->
      <section class="log">
        <h2>Event Log</h2>
        <p class="section-description">
          Real-time view of events being sent to Beacon.
        </p>
        <div id="event-log"></div>
      </section>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
